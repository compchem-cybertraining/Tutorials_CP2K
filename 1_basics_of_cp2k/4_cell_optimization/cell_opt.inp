 &GLOBAL
   PRINT_LEVEL  MEDIUM
   PROJECT_NAME BA2_PbI4_cell_opt
   RUN_TYPE  CELL_OPT
 &END GLOBAL
 &FORCE_EVAL
  ! This one is used for cell optimization
  STRESS_TENSOR ANALYTICAL
  METHOD  QS
  &DFT
    UKS .FALSE. 
    BASIS_SET_FILE_NAME BASIS_MOLOPT
    POTENTIAL_FILE_NAME POTENTIAL 
    &MGRID
      NGRIDS 16
      CUTOFF 500
      REL_CUTOFF 50
    &END MGRID
    &QS
      METHOD GPW
      EPS_DEFAULT 1.000E-14
    &END QS
    &POISSON
      PERIODIC XYZ 
      PSOLVER PERIODIC
    &END
    &SCF
      &DIAGONALIZATION ON
      &END DIAGONALIZATION
      &MIXING
        ALPHA 0.3
        METHOD BROYDEN_MIXING
        NBROYDEN 8
      &END MIXING
      EPS_SCF 1.0E-8
      SCF_GUESS RESTART
      MAX_SCF  50
      ADDED_MOS 50
    &END SCF
    &XC
      &XC_FUNCTIONAL
         &PBE
         &END PBE
      &END XC_FUNCTIONAL
      ! In CP2K versions lower than v7, this part is required for TDDFT calculations
      &XC_GRID
        XC_DERIV SPLINE2_SMOOTH
      &END XC_GRID
      &VDW_POTENTIAL
         POTENTIAL_TYPE PAIR_POTENTIAL 
         &PAIR_POTENTIAL
            PARAMETER_FILE_NAME dftd3.dat
            TYPE DFTD3
            REFERENCE_FUNCTIONAL PBE
            R_CUTOFF [angstrom] 16
         &END
      &END VDW_POTENTIAL
    &END XC
    &PRINT
      &MULLIKEN OFF
      &END
      &HIRSHFELD OFF
      &END
    &END PRINT
  &END DFT
  &SUBSYS

    &CELL
      A   8.4280004501         0.0000000000         0.0000000000
      B   0.0000000000         8.9860000610         0.0000000000
      C   0.0000000000         0.0000000000        26.2329998016
      PERIODIC  XYZ 
    &END CELL

    &TOPOLOGY
      COORD_FILE_NAME unit_cell.xyz
      COORD_FILE_FORMAT XYZ
      ! Only in case you use cif file
      !&GENERATE
      !  REORDER T
      !&END
    &END

    &KIND  Cs
      BASIS_SET DZVP-MOLOPT-SR-GTH 
      POTENTIAL GTH-PBE-q9 
    &END KIND
    &KIND Pb
      BASIS_SET DZVP-MOLOPT-SR-GTH 
      POTENTIAL GTH-PBE-q4
    &END KIND
    &KIND I 
      BASIS_SET  DZVP-MOLOPT-SR-GTH 
      POTENTIAL  GTH-PBE-q7
    &END KIND
    &KIND H
      BASIS_SET  DZVP-MOLOPT-GTH 
      POTENTIAL  GTH-PBE-q1
    &END KIND
    &KIND C 
      BASIS_SET  DZVP-MOLOPT-GTH 
      POTENTIAL  GTH-PBE-q4
    &END KIND
    &KIND O 
      BASIS_SET  DZVP-MOLOPT-GTH 
      POTENTIAL  GTH-PBE-q6
    &END KIND
    &KIND N
      BASIS_SET  DZVP-MOLOPT-GTH 
      POTENTIAL  GTH-PBE-q5
    &END KIND
  &END SUBSYS
 &END FORCE_EVAL

&MOTION
 &CELL_OPT
  TYPE DIRECT_CELL_OPT
  MAX_DR    0.002       
  MAX_FORCE 3.0E-04
  RMS_DR    0.002
  RMS_FORCE 3.0E-04
  PRESSURE_TOLERANCE 100
  EXTERNAL_PRESSURE [bar] 100 0 0 0 100 0 0 0 100
  MAX_ITER 550
  OPTIMIZER BFGS
  ! It is better to let the optimizer change the cell as is needed
  ! KEEP_SYMMETRY .TRUE. will make the optimization harder.
  KEEP_SYMMETRY .FALSE.
 &END CELL_OPT
 &GEO_OPT
   OPTIMIZER BFGS
   MAX_ITER  550
   MAX_DR    [bohr] 0.002
   MAX_FORCE 3.000E-4
   RMS_DR    [bohr] 0.002
   RMS_FORCE 3.000E-4
   &BFGS
   &END
 &END
 &PRINT
  &TRAJECTORY
    &EACH
      GEO_OPT 1
    &END EACH
  &END TRAJECTORY
  &FORCES ON
  &END FORCES
  &STRESS ON
  &END
  &RESTART
    BACKUP_COPIES 1
    &EACH
      GEO_OPT 1
    &END EACH
  &END RESTART
 &END PRINT
&END
